---
title: "Data Science Survey. Split by countries"
author: "[Arkady Kalakutsky](https://jetpeople.jetbrains.com/profile/15735/Arkady.Kalakutsky)"
date: "July, 2018"
initiator: "[Maria Antropova](https://jetbrains.team/m/Maria.Antropova)"
issue: "[RSCH-1465](https://youtrack.jetbrains.com/issue/RSCH-1309)"
goals:
output: 
  odt_document:
    template: "odt.template.xml"
    reference_odt: "reference_file.odt"
keep_md: TRUE
---

```{r setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(cache=FALSE)
knitr::opts_chunk$set(include=TRUE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(error = FALSE)
knitr::opts_chunk$set(results = 'asis')

library(dplyr)
library(tidyr)
library(knitr)
library(pander)
library(extsurvey)
library(survey)
library(fancypander)

panderOptions('table.alignment.default', function(df)
    ifelse(sapply(df, function(x){ 
      if(is.character(x)){
        all(grepl('^(\\d*%|-)$',x)) | all(grepl('^(\\d*%|-)$',x[-1]))
      } else{
        is.numeric(x)
      }}), 'right', 'left'))
panderOptions('table.split.table', Inf)
panderOptions('big.mark', ",")
panderOptions('keep.trailing.zeros', TRUE)
panderOptions('table.style', 'multiline')
panderOptions('missing','-')



fancy.pander <- function(x, ...){
  att <- attributes(x)
  x <- x %>% mutate(values = as.character(values),
                    values = ifelse(grepl("^Other", values), "Other", values))
  attributes(x) <- att
  fancypander::fancy.pander(x, ...)
}


data.clean <- surveyDataScienceWorld2018::data.clean
write.csv(data.clean, "../../clean_data.csv")
survey.design <- survey::svydesign(ids =~ 1 , data = data.clean)

other_countries = c("Brazil", "Jordan", "India", "Russia", "Kenya", "Peru", "Belarus", "Honduras","Australia", "Uruguay", "Georgia","Ethiopia", "Hong Kong", "Fiji", "Nepal", "Philippines", "Montenegro","Mexico","Vietnam", "Pakistan", "Taiwan", "Austria", "Bolivia", "Bangladesh", "South Africa", "Chile", "South Korea", "Antigua and Barbuda","Armenia", "Afghanistan", "Lebanon", "Iraq", "Mauritania", "Azerbaijan",
"Uganda", "Tanzania", "Myanmar", "Sri Lanka")
europe_countries = c("France", "Switzerland", "Germany", "Poland", "Turkey", "Ukraine", 
                     "Portugal", "Czech Republic", "Spain", "Netherlands", "Italy", 
                     "Greece", "Argentina", "Sweden", "Belgium", "Romania", "Hungary",  
                     "Estonia", "Denmark", "Canada",  "Lithuania", "Norway", "Andorra", 
                     "Slovenia", "Indonesia", "Croatia", "Cyprus", "Iceland", "Serbia", 
                     "Macedonia", "Ireland")


survey.designs.by.ctr <- list(
  'USA' = subset(survey.design, `What country do you live in?` == 'United States'),
  'Japan' = subset(survey.design, `What country do you live in?` == 'Japan'),
  'China' = subset(survey.design, `What country do you live in?` == 'China'),
  'Europe' = subset(survey.design, `What country do you live in?` %in% europe_countries)
)
people_from_other_countries = sum(!(data.clean$`What country do you live in?` %in% c('United States', 'Japan', 'China', europe_countries)))

survey.designs.by.ctr.involved <- subset2(survey.designs.by.ctr,  `For you, data analysis is...?` != "I'm not involved in data analysis")

```
All respondents are splitted into four regions: USA, China, Japan and Europe. List of european countries: 
`r knitr::combine_words(europe_countries)`. 

Also there are `r people_from_other_countries`

# General
```{r}
svyciprop.radiobtn2(subset2(survey.designs.by.ctr, `For you, data analysis is...?` != "I'm not involved in data analysis"), "For you, data analysis is...?") %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.checkbox2(subset2(survey.designs.by.ctr.involved, `For you, data analysis is...?` %in%  c("Your primary professional activity","A secondary/additional activity that you perform as part of your job")), field.name.suffix = ":Which of the following are you involved in?") %>% 
  fancy.pander2(make.checks=TRUE)

svyciprop.checkbox2(subset2(survey.designs.by.ctr.involved, `For you, data analysis is...?` %in% c("A hobby","Other – Write In:")), 
                   field.name.suffix = ":Which of the following are area(s) of interest to you?") %>% 
  fancy.pander2(make.checks=TRUE)

svyciprop.checkbox2(survey.designs.by.ctr.involved, 
                   field.name.suffix = ":involved or interested") %>% 
  fancy.pander2(make.checks=TRUE)

svyciprop.radiobtn2(survey.designs.by.ctr.involved,
                   "Do you work with Big Data?") %>%
  fancy.pander2(make.checks=TRUE) 

svyciprop.checkbox2(survey.designs.by.ctr.involved, 
                   field.name.suffix = ":Which..tool(s) do you use for data analysis, if any?") %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.checkbox2(survey.designs.by.ctr.involved, 
                   field.name.suffix = ":What deep learning libraries do you use, if any?") %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.checkbox2(survey.designs.by.ctr.involved, 
                   field.name.suffix = ":Which of the following tool(s) do you use, if any?..",
                   fields.to.ignore = c("has.answered.:Which of the following tool(s) do you use, if any?..")) %>% 
  fancy.pander2(make.checks=TRUE)

```

# Progaramming languages
```{r}

svyciprop.checkbox2(survey.designs.by.ctr.involved, 
                   field.name.suffix = ":What programming language(s) do you regularly use for data analysis, if any?") %>%
  fancy.pander2(make.checks=TRUE)


survey.designs.by.ctr.pl <- subset2(survey.designs.by.ctr.involved, is.na(`None:What programming language(s) do you regularly use for data analysis, if any?`))

svyciprop.radiobtn2(survey.designs.by.ctr.pl, 
                   "What is your main programming language for data analysis?") %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.checkbox2(survey.designs.by.ctr.pl, 
                   field.name.suffix = ":Do you plan to adopt / migrate to other language(s) in the next 12 months?")  %>%
  fancy.pander2(make.checks=TRUE)


svyciprop.radiobtn2(survey.designs.by.ctr.pl, 
                   "In your opinion, what programming language will be most used for data analysis in the next 5 years?") %>%
  fancy.pander2(make.checks=TRUE)



svyciprop.checkbox2(subset2(survey.designs.by.ctr.pl, !is.na(`Python:What programming language(s) do you regularly use for data analysis, if any?`)), 
                   field.name.suffix = ":What data analysis and/or data visualization libraries do you use with Python, if any?") %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.checkbox2(subset2(survey.designs.by.ctr.pl, !is.na(`R:What programming language(s) do you regularly use for data analysis, if any?`)), 
                   field.name.suffix = ":What data analysis and/or data visualization libraries do you use with R, if any?") %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.checkbox2(survey.designs.by.ctr.pl, 
                field.name.suffix = ":What software development tool(s) do you use for data analysis?") %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.checkbox2(subset2(survey.designs.by.ctr.involved, !is.na(`None:What programming language(s) do you regularly use for data analysis, if any?`)), 
                   field.name.suffix = ":Are you planning on adopting any other language(s) in the next 12 months?") %>%
  fancy.pander2(make.checks=TRUE)
```

# other things

```{r}
svyciprop.checkbox2(survey.designs.by.ctr.involved, 
                   field.name.suffix = ":Which statistics package(s) do you use to analyze and visualize..data, if any?") %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.checkbox2(subset2(survey.designs.by.ctr.involved, 
                          `has.answered.What type(s) of data processing do you perform?`), 
                   field.name.suffix = ":What type(s) of data processing do you perform?") %>%
  fancy.pander2(make.checks=TRUE)
pandoc.p("No filtering in the above table. It was unnecessary question")

svyciprop.radiobtn2(subset2(survey.designs.by.ctr.involved,
                          !is.na(`What is the industry you primarily analyze data for?`)), 
                   "What is the industry you primarily analyze data for?") %>%
  fancy.pander2(make.checks=TRUE)
pandoc.p("No filtering in the above table. It was unnecessary question")

itfields <- svyciprop.checkbox2(subset2(survey.designs.by.ctr.involved, `What is the industry you primarily analyze data for?` == 'IT'), 
                   field.name.suffix = ":Which field(s) of IT do you primarily analyze data for?") #%>%
itfields$USA %>% top_n(3, shares) %>% select(values, shares) %>% fancy.pander(caption="USA IT fields", make.checks=FALSE)
itfields$Japan %>% top_n(3, shares) %>% select(values, shares) %>% fancy.pander(caption="Japan IT fields", make.checks=FALSE)
itfields$China %>% top_n(3, shares) %>% select(values, shares) %>% fancy.pander(caption="China IT fields", make.checks=FALSE)
itfields$Europe %>% top_n(3, shares) %>% select(values, shares) %>% fancy.pander(caption="Europe IT fields", make.checks=FALSE)

nonitfields <- svyciprop.checkbox2(subset2(survey.designs.by.ctr.involved, `What is the industry you primarily analyze data for?` == 'A non-IT industry'),
               field.name.suffix = ":Which industry or industries do you primarily analyze data for?") #%>%
  
nonitfields$USA %>% arrange( shares) %>% dplyr::select(values, shares) %>% fancy.pander(caption="USA nonIT industries", make.checks=FALSE)
nonitfields$Japan %>% top_n(3, shares) %>% dplyr::select(values, shares) %>% fancy.pander(caption="Japan nonIT industries", make.checks=FALSE)
nonitfields$China %>% top_n(3, shares) %>% dplyr::select(values, shares) %>% fancy.pander(caption="China nonIT industries", make.checks=FALSE)
nonitfields$Europe %>% top_n(3, shares) %>% select(values, shares) %>% fancy.pander(caption="Europe nonIT industries", make.checks=FALSE)

svyciprop.checkbox2(survey.designs.by.ctr.involved, 
                   field.name.suffix = ":What operating system(s) do you use as your work environment for data analysis?") %>%
  fancy.pander2(make.checks=TRUE)

computations <- svyciprop.checkbox2(survey.designs.by.ctr.involved, 
                   field.name.suffix = ":What do you use to perform computations?",
                   fields.to.ignore = "has.answered.What do you use to perform computations?") 
# computation.attr <- attributes(computations)
# computations <- computations %>% mutate(values = factor(values, ordered = TRUE, levels = 
#                            c("Local machine",
#                              "Cluster with 4 to 10 nodes",
#                              "Cluster with 11 to 50 nodes",
#                              "Cluster with more than 51 nodes",
#                              "Cloud service",
#                              "Other ... Write In:"))) %>% 
#   arrange(values) 
# attributes(computations) <- computation.attr
fancy.pander2(computations, make.checks=TRUE, caption = "What do you use to perform computations?")

svyciprop.checkbox2(subset2(survey.designs.by.ctr.involved, !is.na(`Cloud service:What do you use to perform computations?`)), 
                   field.name.suffix = ":What cloud service(s) do you use for data analysis?") %>%
  fancy.pander2(make.checks=TRUE)

```

# Demography

here we have answers for involved and noninvolved. I can filter out laters.
```{r}
svyciprop.radiobtn2(survey.designs.by.ctr, "Could you tell us your age range?") %>%
  fancy.pander2(make.checks=TRUE)


svyciprop.radiobtn2(survey.designs.by.ctr, "What is your main employment status?") %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.radiobtn2(survey.designs.by.ctr, "What is the highest level of education you have completed?") %>%
  fancy.pander2(make.checks=TRUE)
```

```{R}
svyciprop.radiobtn2(subset2(survey.designs.by.ctr, is.pro), "How long have you been working in data analysis?") %>%
  fancy.pander2(make.checks=TRUE)


 
ds.rus.design <- svydesign(ids= ~1, data = surveyDataScienceRus::ds.rus.data.clean)
ds.rus.pro.design <- subset(ds.rus.design, 
                            (`Анализ данных в основном является для Вас:` %in% 
                               c("Основной профессиональной деятельностью", 
                                 "Дополнительной деятельностью, наряду с другими должностными или профессиональными обязанностями")) &
                              (`Каким образом Вы в основном трудоустроены?  Если Вы студент очного отделения, то, даже если Вы трудоустроены, пожалуйста, выберите вариант "студент".` %in% 
                                 c("Полная занятость по найму", "Частичная занятость по найму"))
                            )
svyciprop.radiobtn(ds.rus.pro.design, "Как долго Вы работаете в сфере анализа данных?") %>% fancy.pander()
```


```{R}
svyciprop.radiobtn2(subset2(survey.designs.by.ctr, 
                          !is.pro & `For you, data analysis is...?` != "I'm not involved in data analysis"), 
                   "How long have you been involved in data analysis?") %>%
  fancy.pander2(make.checks=FALSE)
pandoc.p("we had issues with logic in the above question. 115 people skipped it.")


svyciprop.radiobtn2(subset2(survey.designs.by.ctr, `What is your main employment status?` %in% c("Fully employed by a company / organization")), 
                   "Which of the following best describes the level of your current position?") %>%
  lapply(function(x){select(x, -`lower CI`, -`upper CI`)}) %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.radiobtn2(subset2(survey.designs.by.ctr, `What is your main employment status?` %in% c("Fully employed by a company / organization","Partially employed by a company / organization")), "How many people work for your company / organization?") %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.radiobtn2(subset2(survey.designs.by.ctr, is.pro), "How many people in..total are involved in data analysis at your company?") %>% 
  fancy.pander2(make.checks=TRUE)
pandoc.p("Non necessary question ??")

svyciprop.checkbox2(subset2(survey.designs.by.ctr, is.pro), 
                   field.name.suffix = ":Which of the following best describes your job role(s) regardless of your position level?") %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.radiobtn2(subset2(survey.designs.by.ctr, is.pro), "What is your manager's level of expertise in data analysis?") %>%
  fancy.pander2(make.checks=TRUE)

svyciprop.radiobtn2(subset2(survey.designs.by.ctr, is.pro), "\"My manager gives me realistic assignments that are relevant to my skills and responsibilities, with a clear and specific description of the requirements.\":To what extend do you associate the following phrase with your manager?..") %>%  
  fancy.pander2(make.checks=TRUE)



```


