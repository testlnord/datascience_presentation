---
title: "Data Science Survey. Infographics data"
author: "[Arkady Kalakutsky](https://jetpeople.jetbrains.com/profile/15735/Arkady.Kalakutsky)"
date: "May, 2018"
initiator: "[Vitaly Khudobakhshov](https://jetbrains.team/m/Vitaly.Khudobakhshov)"
issue: "[RSCH-1309](https://youtrack.jetbrains.com/issue/RSCH-1309)"
goals:
output: 
  odt_document:
    template: "odt.template.xml"
    reference_odt: "reference_file.odt"
keep_md: TRUE
---

```{r setup, include=FALSE, cache=FALSE}
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_chunk$set(cache=FALSE)
knitr::opts_chunk$set(include=TRUE)
knitr::opts_chunk$set(warning = FALSE)
knitr::opts_chunk$set(error = FALSE)
knitr::opts_chunk$set(results = 'asis')

library(dplyr)
library(tidyr)
library(knitr)
library(pander)
library(extsurvey)
library(survey)
library(fancypander)

panderOptions('table.alignment.default', function(df)
    ifelse(sapply(df, function(x){ 
      if(is.character(x)){
        all(grepl('^(\\d*%|-)$',x)) | all(grepl('^(\\d*%|-)$',x[-1]))
      } else{
        is.numeric(x)
      }}), 'right', 'left'))
panderOptions('table.split.table', Inf)
panderOptions('big.mark', ",")
panderOptions('keep.trailing.zeros', TRUE)
panderOptions('table.style', 'multiline')
panderOptions('missing','-')



data.clean <- surveyDataScienceWorld2018::data.clean
write.csv(data.clean, "../../clean_data.csv")
survey.design <- survey::svydesign(ids =~ 1 , data = data.clean)
survey.design.involved <- subset(survey.design,  `For you, data analysis is...?` != "I'm not involved in data analysis")

fancy.pander <- function(x, ...){
  att <- attributes(x)
  x <- x %>% mutate(values = as.character(values),
                    values = ifelse(grepl("^Other", values), "Other", values))
  attributes(x) <- att
  fancypander::fancy.pander(x, ..., make.json=TRUE, remove.ci.from.data = TRUE)
}

```


# Tasks
```{r}
SECTION_NAME = 'Tasks'

pros.types = svyciprop.checkbox(subset(survey.design.involved, `For you, data analysis is...?` %in%  c("Your primary professional activity","A secondary/additional activity that you perform as part of your job")), field.name.suffix = ":Which of the following are you involved in?") 

hob.types = svyciprop.checkbox(subset(survey.design.involved, `For you, data analysis is...?` %in% c("A hobby","Other â€“ Write In:")), 
                   field.name.suffix = ":Which of the following are area(s) of interest to you?") 

all.types = svyciprop.checkbox(survey.design.involved, 
                   field.name.suffix = ":involved or interested") 

inner_join(pros.types, hob.types, by="values", suffix=c("pros", "hobs")) %>% inner_join(all.types, by=c("values")) %>% select(values, contains("shares")) %>% rename(Professionals = sharespros, Hobbyists = shareshobs, All = shares) %>% fancy.pander("Types of activities")
```
The above table is made on data from questions "Which of the following are area(s) of interest to you?" and "Which of the following are you involved in?". 


Those who are professionaly involved in data analysis have to pay attention to different types of activities. Data processing and basic statistics are important to many people in the industry. While those who work with data as a hobby tend to select only the things they like. So more hobbyists do data visualisations than statistics.

# Programming languages and tools
```{r}
SECTION_NAME = 'pl_and_tools'

survey.design.pl <- subset(survey.design.involved, is.na(`None:What programming language(s) do you regularly use for data analysis, if any?`))

svyciprop.radiobtn(survey.design.pl, 
                   "What is your main programming language for data analysis?") %>%
  fancy.pander(make.checks=TRUE)

svyciprop.checkbox(survey.design.pl, 
                   field.name.suffix = ":Do you plan to adopt / migrate to other language(s) in the next 12 months?")  %>%
  fancy.pander(make.checks=TRUE)

```

# Kotlin adopters
```{r}
SECTION_NAME = 'Kotlin'

```


```{r}
survey.design.kotlin.ad <- subset(survey.design.pl, !is.na(`Kotlin:Do you plan to adopt / migrate to other language(s) in the next 12 months?`))

kotlin.share <- svyciprop(~kotlin, update(survey.design.pl, kotlin = !is.na(`Kotlin:Do you plan to adopt / migrate to other language(s) in the next 12 months?`)))

```

There are people who want to adopt Kotlin in nearest future (`r round(as.numeric(kotlin.share),2)` from all programming language users). Who are they?

```{r}


svyciprop.checkbox(subset(update(survey.design.kotlin.ad, 
                                 `Other:Which of the following best describes your job role(s) regardless of your position level?` =
                                   if_else( !is.na(`Other ... Write In:Which of the following best describes your job role(s) regardless of your position level?`) |
                                       !is.na(`General/Product Manager:Which of the following best describes your job role(s) regardless of your position level?`) |
                                       !is.na(`Business Analyst:Which of the following best describes your job role(s) regardless of your position level?`) |
                                       !is.na(`Data and Analytics Manager:Which of the following best describes your job role(s) regardless of your position level?`) |
                                       !is.na(`Statistician:Which of the following best describes your job role(s) regardless of your position level?`),
                                     'Other', NA_character_)), is.pro), 
                   field.name.suffix = ":Which of the following best describes your job role(s) regardless of your position level?",
                   good.names = c("Developer:Which of the following best describes your job role(s) regardless of your position level?", 
                                  "Architect:Which of the following best describes your job role(s) regardless of your position level?", 
                                  "Data Scientist:Which of the following best describes your job role(s) regardless of your position level?", 
                                  "Data Analyst:Which of the following best describes your job role(s) regardless of your position level?", 
                                  "Data Architect:Which of the following best describes your job role(s) regardless of your position level?", 
                                  "Data Engineer:Which of the following best describes your job role(s) regardless of your position level?", 
                                  "Researcher:Which of the following best describes your job role(s) regardless of your position level?", 
                                  "Consultant:Which of the following best describes your job role(s) regardless of your position level?", 
                                  "Other:Which of the following best describes your job role(s) regardless of your position level?"
                   )) %>% 
fancy.pander(make.checks=TRUE)

mutate_attr <- function(x, ...){
  x.attr <- attributes(x)
  res <- mutate(x, ...)
  attributes(res) <- x.attr
  res
}


svyciprop.checkbox(survey.design.kotlin.ad, ":What programming language(s) do you regularly use for data analysis, if any?") %>% fancy.pander()
```
Most of them are developers and data analysis is not their primary activity. 
We can't say that they are less experienced or something but most of them have heavy Java background.


```{r}

lang.adoption <- function(lang.name, .design){
  believe.share <- svyciprop(~ tmp.fld, update(.design, 
          tmp.fld = `In your opinion, what programming language will be most used for data analysis in the next 5 years?` == lang.name)
    )

 use.prim.share <- svyciprop(~ tmp.fld, subset(
    update(.design, 
         tmp.fld = `What is your main programming language for data analysis?` == lang.name), 
    `In your opinion, what programming language will be most used for data analysis in the next 5 years?` == lang.name))

 use.regular.share <- 0
 if (!is.null(.design$variables[[paste0(lang.name, ":What programming language(s) do you regularly use for data analysis, if any?")]])) {
 use.regular.share <- svyciprop(~ tmp.fld, subset(
   update(.design, 
          tmp.fld = !is.na(.design$variables[[paste0(lang.name, ":What programming language(s) do you regularly use for data analysis, if any?")]])), 
   `In your opinion, what programming language will be most used for data analysis in the next 5 years?` == lang.name))
 } 
 
 learn.share <- svyciprop(~ tmp.fld, subset(
   update(.design, 
          tmp.fld = !is.na(.design$variables[[paste0(lang.name, ":Do you plan to adopt / migrate to other language(s) in the next 12 months?")]])), 
   `In your opinion, what programming language will be most used for data analysis in the next 5 years?` == lang.name))
 
 data.frame(language = lang.name, believe.share=as.numeric(believe.share),
            use.prim.share = as.numeric(use.prim.share), 
            use.also.share = as.numeric(use.regular.share) - as.numeric(use.prim.share),
            learn.share = as.numeric(learn.share),
            dont.use.share = 1 - as.numeric(use.regular.share) -  as.numeric(learn.share),
            stringsAsFactors = FALSE
            )
}

langs <- c( "R", "Python", "Java", "Scala", "Lua", "Julia", "Matlab/Octave", "Kotlin", "Go", "Rust", "C++")
d <- do.call(rbind, lapply(langs, lang.adoption, survey.design.pl))

d %>% mutate_at(.vars=vars(-believe.share, -language), .funs=funs(.*believe.share)) %>% arrange(desc(believe.share)) %>% setNames(c("values", "Most used", "Use as primary", "Use as auxilary", "Planning to adopt", "None")) %>% fancy.pander("most used in the next 5 years")


```

Note that Go, C++, Julia, Kotlin, Rust and Lua were not an available options in questions about regularly and most used languages. People tend to chouse the language they use. Most of those who don't use language they think will dominate want to start using it.

# Tools & Technologies & Editors

```{r}
SECTION_NAME = 'toolstecheds'

svyciprop.radiobtn.cross.checkbox(survey.design.involved, "Do you work with Big Data?",  ":Which of the following tool(s) do you use, if any?..",
                                  field2.ignore = c("has.answered.:Which of the following tool(s) do you use, if any?..")) %>% 
  fancy.pander("Big Data tools")

```

One third of people claiming that they work with big data don't use any big data tools. Otherwise third of people who don't work with Big data **do** use big data tools. Selfawareness is at least correlated with formal factors.


```{r}
svyciprop.checkbox(survey.design.pl, 
                field.name.suffix = ":What software development tool(s) do you use for data analysis?") %>%
  fancy.pander(make.checks=TRUE, caption="IDEs and Editors")
```

```{r}

svyciprop.checkbox(survey.design.involved, 
                   field.name.suffix = ":Which..tool(s) do you use for data analysis, if any?") %>%
  fancy.pander(make.checks=TRUE)

svyciprop.checkbox(survey.design.involved, 
                   field.name.suffix = ":What deep learning libraries do you use, if any?") %>%
  fancy.pander(make.checks=TRUE)

svyciprop.checkbox(survey.design.involved, 
                   field.name.suffix = ":Which statistics package(s) do you use to analyze and visualize..data, if any?") %>%
  fancy.pander(make.checks=TRUE)

svyciprop.checkbox(survey.design.involved, 
                   field.name.suffix = ":What operating system(s) do you use as your work environment for data analysis?") %>%
  fancy.pander(make.checks=TRUE)
svyciprop.checkbox.cross.checkbox(survey.design.involved, 
                   field1.suffix =  ":What operating system(s) do you use as your work environment for data analysis?",
                   field2.suffix =  ":What operating system(s) do you use as your work environment for data analysis?",
                   field1.ignore = c("Other ... Write In::What operating system(s) do you use as your work environment for data analysis?"),
                   field2.ignore = c("Other ... Write In::What operating system(s) do you use as your work environment for data analysis?")) %>%
  select(values, Linux, Windows, `Mac OS`) %>% 
  fancy.pander(make.checks=TRUE, caption='OS intersections')


computations <- svyciprop.checkbox(survey.design.involved, 
                   field.name.suffix = ":What do you use to perform computations?",
                   fields.to.ignore = "has.answered.What do you use to perform computations?") 
computation.attr <- attributes(computations)
computations <- computations %>% mutate(values = factor(values, ordered = TRUE, levels = 
                           c("Local machine",
                             "Cluster with 4 to 10 nodes",
                             "Cluster with 11 to 50 nodes",
                             "Cluster with more than 51 nodes",
                             "Cloud service",
                             "Other ... Write In:"))) %>% 
  arrange(values) 
attributes(computations) <- computation.attr
fancy.pander(computations, make.checks=TRUE, sort.shares=FALSE, caption = "What do you use to perform computations?")

svyciprop.checkbox(subset(survey.design.involved, !is.na(`Cloud service:What do you use to perform computations?`)), 
                   field.name.suffix = ":What cloud service(s) do you use for data analysis?") %>%
  fancy.pander(make.checks=TRUE)
```

# Non programmers
```{r}
SECTION_NAME = 'nonprogs'

```


```{r}
survey.design.np <- subset(survey.design.involved, !is.na(`None:Are you planning on adopting any other language(s) in the next 12 months?`))

np.share <- svyciprop(~np, update(survey.design.involved, np = !is.na(`None:Are you planning on adopting any other language(s) in the next 12 months?`)))
```

We got `r nrow(survey.design.np)` responses from people who don't use any programming languages and aren't going to adopt any (`r round(as.numeric(np.share) ,2)` of total data analyst population). 

```{r}


svyciprop.checkbox(survey.design.np, 
                   field.name.suffix = ":Which statistics package(s) do you use to analyze and visualize..data, if any?") %>%
  fancy.pander(make.checks=TRUE)


svyciprop.radiobtn(subset(survey.design.np, `What is your main employment status?` %in% c("Fully employed by a company / organization")), 
                   "What is the industry you primarily analyze data for?") %>%
  fancy.pander(make.checks=TRUE, sort.shares = FALSE)


```



They use spreadsheet editors more than people in genral, most of them work in non-it industries. They tend less to use any tools for data analysis. 

No more differences found. 


# managers expertise

```{r}
SECTION_NAME = 'managerexper'


svyciprop.radiobtn(subset(survey.design.involved, is.pro), "What is your manager's level of expertise in data analysis?") %>%
  fancy.pander(make.checks=TRUE, sort.shares = FALSE)

svyciprop.radiobtn(subset(survey.design.involved, is.pro), "\"My manager gives me realistic assignments that are relevant to my skills and responsibilities, with a clear and specific description of the requirements.\":To what extend do you associate the following phrase with your manager?..") %>%  
  fancy.pander(caption=c("what-extend-do-you-associate-the-following-phrase-with-your-manager--"), make.checks=TRUE, sort.shares = FALSE)

svyciprop.radiobtn.cross.radiobtn(subset(survey.design.involved,is.pro),"What is your manager's level of expertise in data analysis?","\"My manager gives me realistic assignments that are relevant to my skills and responsibilities, with a clear and specific description of the requirements.\":To what extend do you associate the following phrase with your manager?..") %>%  
  fancy.pander(make.checks=TRUE, sort.shares = FALSE, caption="Correlation of Manages's expertise and assignments score")
```


# industry and demogr
```{r}
SECTION_NAME = 'industry'


svyciprop.radiobtn(subset(survey.design.involved,
                          !is.na(`What is the industry you primarily analyze data for?`)), 
                   "What is the industry you primarily analyze data for?") %>%
  fancy.pander(make.checks=TRUE)
pandoc.p("No filtering in the above table. It was unnecessary question")

svyciprop.checkbox(subset(survey.design.involved, `What is the industry you primarily analyze data for?` == 'IT'), 
                   field.name.suffix = ":Which field(s) of IT do you primarily analyze data for?") %>%
  fancy.pander(make.checks=TRUE)

svyciprop.checkbox(subset(survey.design.involved, `What is the industry you primarily analyze data for?` == 'A non-IT industry'),
               field.name.suffix = ":Which industry or industries do you primarily analyze data for?") %>%
  fancy.pander(make.checks=TRUE)

```

## Demographics
```{r}
SECTION_NAME = 'demo'


svyciprop.radiobtn(survey.design.involved, "Could you tell us your age range?") %>%
  fancy.pander(make.checks=TRUE, sort.shares = FALSE)
svyciprop.radiobtn(survey.design.involved, "What is your main employment status?") %>%
  fancy.pander(make.checks=TRUE)

svyciprop.radiobtn(survey.design.involved, "What is the highest level of education you have completed?") %>%
  fancy.pander(make.checks=TRUE, sort.shares = FALSE)

svyciprop.radiobtn(subset(survey.design.involved, is.pro), "How long have you been working in data analysis?") %>%
  fancy.pander(make.checks=TRUE, sort.shares = FALSE)
```

## Work environ and empl

```{r}
SECTION_NAME = 'workenvir'

svyciprop.radiobtn(subset(survey.design.involved, `What is your main employment status?` %in% c("Fully employed by a company / organization")), 
                   "Which of the following best describes the level of your current position?") %>%
  fancy.pander(make.checks=TRUE, sort.shares = FALSE)

svyciprop.radiobtn(subset(survey.design.involved, `What is your main employment status?` %in% c("Fully employed by a company / organization","Partially employed by a company / organization")), "How many people work for your company / organization?") %>%
  fancy.pander(make.checks=TRUE, sort.shares = FALSE)

svyciprop.radiobtn(subset(survey.design.involved, is.pro), "How many people in..total are involved in data analysis at your company?") %>% 
  fancy.pander(make.checks=TRUE, sort.shares = FALSE)
pandoc.p("Non necessary question ??")

svyciprop.checkbox(subset(survey.design.involved, is.pro), 
                   field.name.suffix = ":Which of the following best describes your job role(s) regardless of your position level?") %>%
  fancy.pander(make.checks=TRUE)

```



```{r json_norm_last_chunk, cache=FALSE}
### THE LAST CHUNK

system('python3 norm_json.py')

```
